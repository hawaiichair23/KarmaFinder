<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RedditFinder - Better Reddit Search</title>
    <style>
    html {
   font-size: 90%;
}
        :root {
            --primary-color: #ff4500;
            --secondary-color: #0079d3;
            --background-color: #f8f9fa;
            --card-color: #ffffff;
            --text-color: #1a1a1b;
            --light-text: #787c7e;
            --border-color: #edeff1;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px 0;
        }

        .logo {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .tagline {
            font-size: 1.2rem;
            color: var(--light-text);
        }

        .search-container {
            position: relative;
            /*transform: scale(0.99);*/
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 30px;
            background-color: var(--card-color);
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .search-input-container {
            display: flex;
            width: 100%;
        }

        .search-input {
            flex-grow: 1;
            padding: 12px 20px;
            font-size: 1.1rem;
            border: 1px solid var(--border-color);
            border-radius: 4px 0 0 4px;
            outline: none;
        }

        .search-input:focus {
            border-color: var(--secondary-color);
        }

        .search-button {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 0 4px 4px 0;
            padding: 0 20px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: bold;
            transition: background-color 0.2s;
        }

        .search-button:hover {
            background-color: #005fa3;
        }

        .advanced-options {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }

        .option-group {
            flex: 1;
            min-width: 200px;
        }

        .option-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .option-group select,
        .option-group input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
        }

        .subreddit-dropdown {
            position: relative;
            z-index: 10000; /* High stacking context to avoid being overlapped */
        }   
        .subreddit-suggestions {
            position: absolute;
            background-color: var(--card-color, #fff);
            width: 100%;
            border: 1px solid #999;
            border-radius: 6px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            z-index: 10000;
            max-height: 300px;
            overflow-y: auto;
            display: none; /* Hidden by default */
            scrollbar-width: none;
            scrollbar-color:rgba(150, 150, 150, 0.6);
            transition: scrollbar-color 0.3s ease;

        }
        
/**/        .subreddit-suggestions .custom-spinner-wrapper {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px 0;
            
        }

 /**/       .subreddit-suggestions-container {
            max-height: 300px;
            overflow-y: auto;
            scrollbar-width: none;
            scrollbar-color: white;
        }

        .subreddit-suggestions-container::-webkit-scrollbar {
            width: 4px;
        }

        .subreddit-suggestions-container::-webkit-scrollbar-track {
            background: transparent;
        }

        .subreddit-suggestions-container::-webkit-scrollbar-thumb {
            background-color: transparent;
            border-radius: 4px;
        }

 /**/       .subreddit-suggestions-container:hover {
            scrollbar-color: rgba(150, 150, 150, 0.6);
            scrollbar-width: thin;
        }

        .subreddit-suggestions-container:hover::-webkit-scrollbar-thumb {
            background-color: rgba(150, 150, 150, 0.6);
        }

        .subreddit-suggestions-container:hover::-webkit-scrollbar-thumb:hover,
        .subreddit-suggestions-container:hover::-webkit-scrollbar-thumb:active {
            background-color: rgba(150, 150, 150, 0.6);
        }

        .subreddit-suggestions.active {
            display: block;
        }

        .subreddit-suggestion {
            padding: 8px 12px;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }

        .subreddit-suggestion:hover {
            background-color: var(--background-color);
        }

.subreddit-suggestions::-webkit-scrollbar {
    width: 4px;
}

.subreddit-suggestions::-webkit-scrollbar-track {
    background: transparent;
}

.subreddit-suggestions::-webkit-scrollbar-thumb {
    background-color: transparent;
    border-radius: 4px;
}

.subreddit-suggestions:hover {
    scrollbar-color: rgba(180, 180, 180, 0.5) transparent; /* Firefox */
}

.subreddit-suggestions:hover::-webkit-scrollbar-thumb {
    background-color: transparent; /* WebKit */
}

.subreddit-suggestions:hover::-webkit-scrollbar-thumb:hover,
.subreddit-suggestions:hover::-webkit-scrollbar-thumb:active {
    background-color: transparent; /* On interaction */
}


        .subreddit-icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }

        .subreddit-icon img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
        }

        .results-container {
            display: flex;
            position: relative;
            flex-direction: column;
            gap: 3px;
        }

        .result-card {
           /* transform: scale(0.99);*/
            position: relative;
            margin-bottom: 15px;
            overflow: visible; 
            display: flex;
            flex-direction: row;
            align-items: center;
            padding: 10px;
            border-radius: 8px;
            background-color: #fff;
            min-height: 130px; 
            transition: all 0.15s ease-in-out;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            z-index: 1; /* Lower than dropdown */
        }

         .result-card:hover { 
            transform: translateY(-0.05px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .vote-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 40px;
        }

        .vote-button {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--light-text);
            transition: color 0.2s;
        }

        .vote-button:hover {
            color: var(--secondary-color);
        }

        .vote-count {
            font-weight: bold;
            margin: 5px 0;
        }

        .content-section {     
            flex-grow: 1;
            overflow: hidden;
            margin-left: 15px;
            color: #29213b;
            margin-right: 0;
        }

        .result-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 5px;
            font-size: 1rem;
            color: var(--light-text);
            color: #15121c;
            font-weight: 400;
        }

        .result-subreddit {
            display: flex;
            align-items: center;
            gap: 5px;
            font-weight: 600;
            color: var(--text-color);
            text-decoration: none;
        }

        .result-subreddit:hover {
            text-decoration: underline;
        }

        .result-author,
        .result-time {
            margin-left: 5px;
        }

        .result-title {
            font-size: 1.2rem;
            margin-bottom: 8px;
            font-weight: 600;
            color: #15121c;
        }

        .result-title a {
            color: var(--text-color);
            text-decoration: none;
        }

        .result-title a:hover {
            color: var(--secondary-color);
        }

        .result-content {
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .result-actions {
            display: flex;
            gap: 15px;
            color: var(--light-text);
        }

        .result-action {
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .result-action:hover {
            color: var(--text-color);
        }

        .error-card {
        padding: 20px;
        border-radius: 4px;
        background-color: var(--card-color);
        color: var(--text-color); 
        }


        /* Comments section styles */
        .comments-section {
            width: 300px;
            font-size: small;
            flex-shrink: 0;
            max-height: 100px;
            overflow-y: auto;
            background-color: #f9f9f9;
            border-radius: 6px;
            padding: 8px;
            margin-left: 15px;
            margin-right: 25px;

        /* Scrollbar */
            scrollbar-width: thin; /* For Firefox */
            scrollbar-color: transparent transparent; /* For Firefox */
            transition: scrollbar-color 0.3s ease;
        }

        .comments-section::-webkit-scrollbar {
            width: 4px;
        }

        .comments-section::-webkit-scrollbar-track {
            background: transparent;
        }

        .comments-section::-webkit-scrollbar-thumb {
            background-color: transparent;
            border-radius: 4px;
        }

        .comments-section:hover {
            scrollbar-color: rgba(180, 180, 180, 0.5) transparent; /* For Firefox */
        }

        .comments-section:hover::-webkit-scrollbar-thumb {
            background-color: rgba(180, 180, 180, 0.5); /* Light gray with transparency */
        }

        /* When scrollbar is actively being used */
        .comments-section:hover::-webkit-scrollbar-thumb:hover,
        .comments-section:hover::-webkit-scrollbar-thumb:active {
            background-color: rgba(160, 160, 160, 0.7); /* Darker when hovered/active */
        }

        .comment {
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid #eee;
        }

        .comment:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .comment-author {
            font-weight: bold;
            margin-bottom: 2px;
            display: flex;
            align-items: center;
        }

        .comment-author-icon {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background-color: var(--light-text);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 8px;
            margin-right: 5px;
        }

        .comment-text {
            line-height: 1.3;
            word-break: break-word;
        }

        .comment-meta {
            display: flex;
            font-size: 10px;
            color: var(--light-text);
            margin-top: 2px;
        }

        .comment-score {
            margin-right: 6px;
        }

        .comment-time {
            margin-left: auto;
        }

        .loading-comments {
            color: var(--light-text);
            text-align: center;
            font-style: italic;
        }

        .see-more-comments {
            text-align: center;
            padding-top: 5px;
            font-size: 11px;
            color: var(--secondary-color);
            cursor: pointer;
            font-weight: bold;
        }

        .see-more-comments:hover {
            text-decoration: underline;
        }    

        .action-icon {
            vertical-align: middle;
        }

        .result-image {
            max-width: 140px;
            max-height: 100px;
            border-radius: 4px;
            object-fit: cover;
        }

        .loading {
            text-align: center;
            padding: 40px 20px;
            color: var(--light-text);
        }

        .pagination {
            display: flex;
            justify-content: center;
            margin-top: 20px;
            gap: 10px;
        }

        .pagination-button {
            background-color: var(--card-color);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 8px 16px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.2s;
        }

        .pagination-button:hover:not(:disabled) {
            background-color: #f0f0f0;
        }

        .pagination-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .filter-chip-container {
            display: none;
            align-items: center;
            background-color: var(--background-color);
            border-radius: 16px;
            padding: 3px 10px;
            gap: 5px;
            margin-top: 5px;
        }

        .filter-chip-container .chip-text {
            font-size: 0.9rem;
        }

        .filter-chip-container .remove-chip {
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background-color: var(--light-text);
            color: white;
            font-size: 10px;
            line-height: 1;
        }

        footer {
            margin-top: 40px;
            text-align: center;
            padding: 20px;
            color: var(--light-text);
            font-size: 0.9rem;
        }

        .donate-btn {
            display: inline-block;
            margin-top: 10px;
            background-color: var(--primary-color);
            color: white;
            padding: 8px 16px;
            border-radius: 4px;
            text-decoration: none;
            font-weight: bold;
            transition: background-color 0.2s;
        }

        .donate-btn:hover {
            background-color: #e03d00;
        }

        @media (max-width: 768px) {
            .advanced-options {
                flex-direction: column;
            }

            .result-card {
                display: flex;
                flex-direction: row;
                align-items: flex-start;
                padding: 15px;
                position: relative;
            }

            .vote-section {
                flex-shrink: 0;
                flex-direction: row;
                justify-content: center;
                gap: 10px;
            }
        }

        .img-container {
            margin-left: auto;
            position: relative;
            width: 140px;
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .img-container img {
            width: 100%;
            position: relative;
            max-width: 140px;
            max-height: 100px;
            border-radius: 4px;
            object-fit: cover;
        }
        
        .img-container .play-icon {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
            pointer-events: none;
            background-color: rgba(0, 0, 0, 0.6);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

.theme-toggle {
  position: fixed;
  top: 16px;
  left: 20px;
  right: unset;
  width: 50px;
  height: 50px;
  padding: 4px;
  background: transparent;
  border: none;
  border-radius: 50%;
  cursor: pointer;
  z-index: 10000;
}

.theme-toggle img {
  width: 100%;
  height: 100%;
  object-fit: contain;
  transition: filter 0.3s ease;
}

/* Dark mode base */
body.dark-mode {
  background-color: #121212;
  color: #f5f5f5;
}

/* Light-dark cards */
body.dark-mode .result-card,
body.dark-mode .results-container,
body.dark-mode .search-box,
body.dark-mode .search-controls,
body.dark-mode .error-card,
body.dark-mode .comment-box,
body.dark-mode .search-container,
body.dark-mode .subreddit-chip,
body.dark-mode .subreddit-suggestion,
body.dark-mode .subreddit-suggestions .custom-spinner-wrapper,
body.dark-mode .subreddit-suggestions::-webkit-scrollbar,
body.dark-mode .subreddit-dropdown,
body.dark-mode .spinner-container {
  background-color: #1e1e1e; /* lighter dark grey */
  color: #ffffff;
  border-color: #333; /* optional border */
}

/* Inputs and dropdowns */
body.dark-mode input,
body.dark-mode select,
body.dark-mode textarea {
  background-color:  #595959 ;
  color: #fff;
  border-color: #444;
}

/* Scrollbar */
body.dark-mode .subreddit-suggestions::-webkit-scrollbar-thumb {
    background-color: transparent;
}

body.dark-mode .subreddit-suggestions:hover::-webkit-scrollbar-thumb {
    background-color: #444; /* visible on hover */
}

body.dark-mode .subreddit-suggestions:hover::-webkit-scrollbar-thumb:hover,
body.dark-mode .subreddit-suggestions:hover::-webkit-scrollbar-thumb:active {
    background-color: #444;
}

body.dark-mode .subreddit-suggestions {
  scrollbar-width: none;
}

body.dark-mode .subreddit-suggestions:hover {
  scrollbar-color: #444;
  scrollbar-width: thin;
  background-color: #1e1e1e;
}
body.dark-mode .subreddit-suggestions-container {
  scrollbar-width: none;
  scrollbar-color: transparent transparent; /* For Firefox */
  background-color: #1e1e1e;
}

body.dark-mode .subreddit-suggestions-container:hover {
  scrollbar-width: thin;
  scrollbar-color: #444; /* Thumb appears on hover */
}

    </style>
</head>

<body>
    <div class="container">
        <header>
            <div class="logo">RedditFinder</div>
            <div class="tagline">Find exactly what you're looking for on Reddit</div>
        </header>

<button id="themeToggle" class="theme-toggle" aria-label="Toggle Dark Mode">
    <img id="themeIcon" src="moon.png" alt="Toggle theme" />
</button>

        <div class="search-container">
            <div class="search-input-container">
                <input type="text" id="search-input" class="search-input" placeholder="Search Reddit..." autofocus>
                <button id="search-button" class="search-button">Search</button>
            </div>

            <div class="advanced-options">
                <div class="option-group">
                    <label for="sort-select">Sort By</label>
                    <select id="sort-select">
                        <option value="relevance">Relevance</option>
                        <option value="hot">Hot</option>
                        <option value="top">Top</option>
                        <option value="new">New</option>
                        <option value="comments">Comments</option>
                    </select>
                </div>

                <div class="option-group">
                    <label for="time-select">Time Period</label>
                    <select id="time-select">
                        <option value="all">All Time</option>
                        <option value="year">Past Year</option>
                        <option value="month">Past Month</option>
                        <option value="week">Past Week</option>
                        <option value="day">Past 24 Hours</option>
                        <option value="hour">Past Hour</option>
                    </select>
                </div>

                <div class="option-group subreddit-dropdown">
                    <label for="subreddit-input">Subreddit (optional)</label>
                    <input type="text" id="subreddit-input" placeholder="e.g., AskReddit">
                    <div id="subreddit-suggestions-container">
                        <div id="subreddit-suggestions" class="subreddit-suggestions"></div>
                    </div>
                    <div class="filter-chip-container" id="subreddit-chip-container">
                        <span class="chip-text"></span>
                        <span class="remove-chip">×</span>
                    </div>
                </div>

                <div class="option-group">
                    <label for="content-select">Content Type</label>
                    <select id="content-select">
                        <option value="all">All Content</option>
                        <option value="posts">Posts Only</option>
                        <option value="comments">Comments Only</option>
                    </select>
                </div>
            </div>
        </div>

        <div id="results" class="results-container">
            <!-- Results will be populated here -->
        </div>

        <div id="pagination" class="pagination">
            <!-- Pagination will be added here -->
        </div>

        <footer>
            <p>RedditFinder helps you search Reddit content more effectively than Reddit's native search.</p>
            <p>If you find this tool useful, please consider supporting its development.</p>
            <a href="#" class="donate-btn">Donate</a>
        </footer>
    </div>

    <script>
        // Configuration 
        const API_ENDPOINT = 'http://localhost:3000/reddit';

        const RESULTS_PER_PAGE = 10;

        let searchTimeout = null;

        let POPULAR_SUBREDDITS = [
            { name: 'AskReddit', icon: '/api/placeholder/20/20' },
            { name: 'funny', icon: '/api/placeholder/20/20' },
            { name: 'gaming', icon: '/api/placeholder/20/20' }
            // These are just fallbacks in case the API request fails
        ];

        // Add this function to fetch popular subreddits
        function fetchPopularSubreddits() {
            console.log("Attempting to fetch popular subreddits...");

            // Start with an empty array - we'll populate it completely from the API
            fetch('http://localhost:3000/reddit?url=https://www.reddit.com/subreddits/popular.json?limit=100')
                .then(response => {
                    if (!response.ok) throw new Error('Failed to fetch popular subreddits');
                    return response.json();
                })
                .then(data => {
                    if (data && data.data && data.data.children) {
                        POPULAR_SUBREDDITS = data.data.children.map(child => ({
                            name: child.data.display_name,
                            icon: child.data.icon_img || '/api/placeholder/20/20'
                        }));
                        console.log('Loaded popular subreddits:', POPULAR_SUBREDDITS.length);

                        // Keep some fallbacks only if the API returned nothing
                        if (POPULAR_SUBREDDITS.length === 0) {
                            POPULAR_SUBREDDITS = [
                                { name: 'AskReddit', icon: '/api/placeholder/20/20' },
                                { name: 'funny', icon: '/api/placeholder/20/20' },
                                { name: 'gaming', icon: '/api/placeholder/20/20' }
                            ];
                        }
                    }
                })
                .catch(error => {
                    console.error('Error fetching popular subreddits:', error);
                });
        }

        // Call this function when the page loads
        document.addEventListener('DOMContentLoaded', fetchPopularSubreddits);

        // DOM Elements
        const searchInput = document.getElementById('search-input');
        const searchButton = document.getElementById('search-button');
        const sortSelect = document.getElementById('sort-select');
        const timeSelect = document.getElementById('time-select');
        const subredditInput = document.getElementById('subreddit-input');
        const contentSelect = document.getElementById('content-select');
        const resultsContainer = document.getElementById('results');
        const paginationContainer = document.getElementById('pagination');
        const subredditSuggestions = document.getElementById('subreddit-suggestions');
        const subredditChipContainer = document.getElementById('subreddit-chip-container');
        const dropdown = document.getElementById('subreddit-suggestions');

        // State
        let currentQuery = '';
        let currentAfter = null;
        let currentBefore = null;
        let isLoading = false;
        let currentFilters = {
            sort: 'relevance',
            time: 'all',
            subreddit: '',
            contentType: 'all'
        };

        // Event Listeners
        searchButton.addEventListener('click', () => performSearch());
        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                performSearch();
            }
        });

        sortSelect.addEventListener('change', () => {
            currentFilters.sort = sortSelect.value;
        });

        timeSelect.addEventListener('change', () => {
            currentFilters.time = timeSelect.value;
        });

        contentSelect.addEventListener('change', () => {
            currentFilters.contentType = contentSelect.value;
        });

        // Remove subreddit filter when clicking X
        subredditChipContainer.querySelector('.remove-chip').addEventListener('click', () => {
            currentFilters.subreddit = '';
            subredditChipContainer.style.display = 'none';
        });

        // Handle suggestion selection
        subredditSuggestions.addEventListener('click', (e) => {
            const suggestion = e.target.closest('.subreddit-suggestion');
            if (suggestion) {
                const subName = suggestion.getAttribute('data-name');
                selectSubreddit(subName);
            }
        });

       // Handle typing in subreddit input
        subredditInput.addEventListener('input', () => {
            const query = subredditInput.value.toLowerCase().trim();

            // Show dropdown immediately with a loading spinner
            if (query.length > 0) {
                if (!subredditSuggestions.querySelector('.custom-spinner-wrapper')) {
                    subredditSuggestions.innerHTML = '';
                    subredditSuggestions.appendChild(createCanvasSpinner());
                }

                subredditSuggestions.classList.add('active');
            } else {
                subredditSuggestions.classList.remove('active');
            }

            // Debounce Reddit API call
            if (searchTimeout) clearTimeout(searchTimeout);

            searchTimeout = setTimeout(() => {
                handleSubredditSuggestions(query);
            }, 200); // delay debounce here
        });

    // Cubic-bezier easing 
    function cubicBezier(p0, p1, p2, p3) {
        return function (t) {
            const cx = 3 * (p1 - p0);
            const bx = 3 * (p2 - p1) - cx;
            const ax = 1 - cx - bx;

            const cy = 3 * (p1 - p0);
            const by = 3 * (p2 - p1) - cy;
            const ay = 1 - cy - by;

            let x = t, t2 = t;
            for (let i = 0; i < 5; i++) {
                const f = ax * t2 * t2 * t2 + bx * t2 * t2 + cx * t2 - x;
                const df = 3 * ax * t2 * t2 + 2 * bx * t2 + cx;
                t2 = t2 - f / df;
                t2 = Math.max(0, Math.min(t2, 1));
            }

            return ay * t2 * t2 * t2 + by * t2 * t2 + cy * t2;
        };
    }

 // Begin animation
    function startSpinnerAnimation(ctx) {
        const easeCustom = cubicBezier(0.1, 0.83, 0.37, 1);
        const cycleDuration = 700;
        let startTime = null;

        function animate(timestamp) {
            if (!startTime) startTime = timestamp;

            const elapsed = timestamp - startTime;
            const t = (elapsed % cycleDuration) / cycleDuration;
            const ramp = Math.pow(t, 0.8);
            const eased = easeCustom(ramp);

            const angle = (eased * 6.28 + 7.8) % 6.28;
            const shrinkEase = easeCustom(t);
            const sinePhase = Math.sin(shrinkEase * Math.PI);
            const shrinkPhase = easeCustom(sinePhase);
            const shrink = 0.5 + 0.5 * shrinkPhase;
            const arcLength = Math.PI * 0.7 * shrink;

            ctx.clearRect(0, 0, 50, 50);
            ctx.beginPath();
            const arcStart = angle - arcLength;
            ctx.arc(25, 25, 18, arcStart, angle);
            ctx.strokeStyle = "#C1C0C1";
            ctx.lineWidth = 4;
            ctx.stroke();

            requestAnimationFrame(animate);
        }

        requestAnimationFrame(animate);
    }

    // SPINNY
    function createCanvasSpinner() {
            const wrapper = document.createElement('div');
            wrapper.className = 'custom-spinner-wrapper';
            wrapper.style.cssText = `
        display: flex;
        justify-content: center;
        align-items: center;
        width: 100%;
        height: 80px;
    `;

            const canvas = document.createElement('canvas');
            canvas.width = 50;
            canvas.height = 50;
            canvas.id = 'main-spinner-placeholder';
            wrapper.appendChild(canvas);

            const ctx = canvas.getContext('2d');
            startSpinnerAnimation(ctx); // 🧠 THIS is now reusable and safe

            return wrapper;
        }

        // combine popular and other search results to same timing
        async function handleSubredditSuggestions(query) {
                const localMatches = POPULAR_SUBREDDITS.filter(sub =>
                    sub.name.toLowerCase().startsWith(query)
                );

                let remoteMatches = [];

                try {
                    const res = await fetch(`http://localhost:3000/reddit?url=https://www.reddit.com/subreddits/search.json?q=${encodeURIComponent(query)}`);
                    const data = await res.json();

                    if (data?.data?.children?.length > 0) {
                        remoteMatches = data.data.children
                            .filter(child => child.data.display_name.toLowerCase().startsWith(query))
                            .map(child => ({
                                name: child.data.display_name,
                                icon: child.data.icon_img || '/api/placeholder/20/20'
                            }));
                    }
                } catch (err) {
                    console.error("Subreddit fetch failed:", err);
                }

                const merged = [...localMatches, ...remoteMatches].filter(
                    (sub, index, self) =>
                        index === self.findIndex(s => s.name === sub.name)
                );

                subredditSuggestions.innerHTML = ''; // clear spinner

                if (merged.length === 0) {
                subredditSuggestions.innerHTML = '<div class="no-results">No subreddits found</div>';
                return;
            }

                populateSubredditSuggestions(merged);
                
            }

        function fetchSubredditSuggestions(query) {
            console.log("Searching for subreddits containing:", query);

            // Use Reddit's API to search for subreddits matching the query
            fetch(`http://localhost:3000/reddit?url=https://www.reddit.com/subreddits/search.json?q=${encodeURIComponent(query)}`)
                .then(response => {
                    if (!response.ok) throw new Error('Failed to search subreddits');
                    return response.json();
                })
                .then(data => {
                    if (data && data.data && data.data.children && data.data.children.length > 0) {
                        // Only keep subreddits that start with the query
                        const searchResults = data.data.children
                            .filter(child => child.data.display_name.toLowerCase().startsWith(query.toLowerCase()))
                            .map(child => ({
                                name: child.data.display_name,
                                icon: child.data.icon_img || '/api/placeholder/20/20'
                            }));

                        console.log('Filtered search results:', searchResults);

                        // Get current suggestion names to avoid duplicates
                        const currentSuggestions = Array.from(subredditSuggestions.children)
                            .map(el => el.getAttribute('data-name'));

                        const newSuggestions = searchResults.filter(sub =>
                            !currentSuggestions.includes(sub.name)
                        );

                        if (newSuggestions.length > 0) {
                            appendSubredditSuggestions(newSuggestions);
                        }
                    }
                })
                .catch(error => {
                    console.error('Error searching subreddits:', error);

                    // For fallback, also be more strict
                    setTimeout(() => {
                        const simulatedResults = [
                            { name: query + 'Pics', icon: '/api/placeholder/20/20' },
                            { name: query + 'Memes', icon: '/api/placeholder/20/20' },
                            { name: query + 'Pro', icon: '/api/placeholder/20/20' }
                        ];

                        const currentSuggestions = Array.from(subredditSuggestions.children)
                            .map(el => el.getAttribute('data-name'));

                        const newSuggestions = simulatedResults.filter(sub =>
                            !currentSuggestions.includes(sub.name)
                        );

                        if (newSuggestions.length > 0) {
                            appendSubredditSuggestions(newSuggestions);
                        }
                    }, 300);
                });
        }

        function populateSubredditSuggestions(subreddits) {
            console.log("Populating subreddit suggestions:", subreddits);

            // Clear the suggestions container first
            subredditSuggestions.innerHTML = '';

            // Sort subreddits by relevance to the search query
            const query = subredditInput.value.toLowerCase().trim();
            if (query.length > 0) {
                subreddits.sort((a, b) => {
                    const aName = a.name.toLowerCase();
                    const bName = b.name.toLowerCase();

                    // Exact matches first
                    if (aName === query && bName !== query) return -1;
                    if (bName === query && aName !== query) return 1;

                    // Then starts with matches
                    if (aName.startsWith(query) && !bName.startsWith(query)) return -1;
                    if (bName.startsWith(query) && !aName.startsWith(query)) return 1;

                    // Then contains matches (already handled by filtering)
                    // Finally alphabetical
                    return aName.localeCompare(bName);
                });
            }

            // If there are results from filtering, add them
            if (subreddits.length > 0) {
                subreddits.forEach(sub => {
                    const suggestion = document.createElement('div');
                    suggestion.className = 'subreddit-suggestion';
                    suggestion.setAttribute('data-name', sub.name);

                    const iconEl = document.createElement('div');
                    iconEl.className = 'subreddit-icon';

                    if (sub.icon && sub.icon !== '/api/placeholder/20/20') {
                        const img = document.createElement('img');
                        img.src = sub.icon;
                        img.alt = sub.name;
                        iconEl.appendChild(img);
                    } else {
                        iconEl.textContent = sub.name.charAt(0).toUpperCase();
                    }

                    suggestion.appendChild(iconEl);
                    suggestion.appendChild(document.createTextNode(sub.name));

                    subredditSuggestions.appendChild(suggestion);
                });
            }

            // Add an attribute to track if we have results
            subredditSuggestions.setAttribute('data-has-results', subreddits.length > 0 ? 'true' : 'false');
        }

        function appendSubredditSuggestions(subreddits) {
            // First, check if we already have results
            const hasResults = subredditSuggestions.getAttribute('data-has-results') === 'true';

            // If we have new suggestions and no existing ones, remove any "no results" message
            if (subreddits.length > 0 && !hasResults) {
                subredditSuggestions.innerHTML = '';
                subredditSuggestions.setAttribute('data-has-results', 'true');
            }

            subreddits.forEach(sub => {
                const suggestion = document.createElement('div');
                suggestion.className = 'subreddit-suggestion';
                suggestion.setAttribute('data-name', sub.name);

                const iconEl = document.createElement('div');
                iconEl.className = 'subreddit-icon';

                if (sub.icon && sub.icon !== '/api/placeholder/20/20') {
                    const img = document.createElement('img');
                    img.src = sub.icon;
                    img.alt = sub.name;
                    iconEl.appendChild(img);
                } else {
                    iconEl.textContent = sub.name.charAt(0).toUpperCase();
                }

                suggestion.appendChild(iconEl);
                suggestion.appendChild(document.createTextNode(sub.name));

                subredditSuggestions.appendChild(suggestion);
            });
        }

        function selectSubreddit(subName) {
            currentFilters.subreddit = subName;
            subredditChipContainer.style.display = 'flex';
            subredditChipContainer.querySelector('.chip-text').textContent = 'r/' + subName;
            subredditInput.value = '';
            subredditSuggestions.classList.remove('active');
        }

        function performSearch(after = null, before = null) {
            const query = searchInput.value.trim();
            if (!query) return;

            currentQuery = query;
            currentAfter = after;
            currentBefore = before;

            showLoading();

           let baseQuery = query;

// ✅ Apply subreddit filter
if (currentFilters.subreddit) {
    baseQuery += `+subreddit:${currentFilters.subreddit}`;
}

// ✅ Build API URL with all filters
let url = `${API_ENDPOINT}?url=${encodeURIComponent('https://www.reddit.com/search.json?q=' + baseQuery)}`;

// ✅ Sort
url += `&sort=${currentFilters.sort}`;

// ✅ Time filter
if (currentFilters.sort === 'top' || currentFilters.sort === 'comments') {
    url += `&t=${currentFilters.time}`;
}

// ✅ Content type filter
if (currentFilters.contentType === 'comments') {
    url += '&type=comment';
} else if (currentFilters.contentType === 'posts') {
    url += '&type=link';
}

// ✅ Pagination
url += `&limit=${RESULTS_PER_PAGE}`;
if (after) {
    url += `&after=${after}`;
} else if (before) {
    url += `&before=${before}`;
}

            // Fetch results from Reddit API
            fetch(url)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    displayResults(data.data);
                })
                .catch(error => {
                    console.error('Error fetching data:', error);

                    resultsContainer.innerHTML = `
                        <div class="error-card">
                            <p>Sorry, there was an error fetching results.</p>
                            <p>Error details: ${error.message}</p>
                        </div>
                    `;
                    
                    resultsContainer.style.display = 'block';
                    resultsContainer.scrollIntoView({ behavior: 'smooth' });

                    paginationContainer.innerHTML = '';
                })
                .finally(() => {
                    isLoading = false;
                });
        }

        function showLoading() {
                isLoading = true;
                resultsContainer.innerHTML = ''; // Clear previous content

                const spinnerWrapper = createCanvasSpinner();
                resultsContainer.appendChild(spinnerWrapper);

                paginationContainer.innerHTML = '';
            }

        // Function to fetch comments for a post
            function fetchComments(permalink, commentsContainer) {
                commentsContainer.innerHTML = `
    <div class="loading-comments">
        <div class="spinner" id="comment-spinner-placeholder"></div>
    </div>
`;
                const commentSpinner = document.querySelector('#comment-spinner-placeholder');
                if (commentSpinner) commentSpinner.replaceWith(createCanvasSpinner());

                // Reddit API URL for comments (no auth required)
                const commentsUrl = `http://localhost:3000/reddit?url=https://www.reddit.com${permalink}.json`;

                fetch(commentsUrl)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Failed to fetch comments');
                        }
                        return response.json();
                    })
                    .then(data => {
                        // The comments are in the second element of the array
                        const commentsData = data[1].data.children;

                        if (commentsData.length === 0) {
                            commentsContainer.innerHTML = '<div class="loading-comments">No comments found</div>';
                            return;
                        }

                        // Sort comments by score (highest first)
                        commentsData.sort((a, b) => (b.data.score || 0) - (a.data.score || 0));

                        // Clear the container
                        commentsContainer.innerHTML = '';

                        // Display top 5 comments
                        const topComments = commentsData.slice(0, 5);
                        topComments.forEach(comment => {
                            if (comment.kind !== 't1') return; // Skip non-comment items

                            const commentData = comment.data;

                            // Create comment element
                            const commentEl = document.createElement('div');
                            commentEl.className = 'comment';

                            // Author section
                            const authorEl = document.createElement('div');
                            authorEl.className = 'comment-author';

                            const authorIconEl = document.createElement('div');
                            authorIconEl.className = 'comment-author-icon';
                            authorIconEl.textContent = commentData.author.charAt(0).toUpperCase();

                            authorEl.appendChild(authorIconEl);
                            authorEl.appendChild(document.createTextNode(commentData.author));

                            // Comment text
                            const textEl = document.createElement('div');
                            textEl.className = 'comment-text';
                            textEl.textContent = commentData.body.length > 150
                                ? commentData.body.substring(0, 150) + '...'
                                : commentData.body;

                            // Comment metadata
                            const metaEl = document.createElement('div');
                            metaEl.className = 'comment-meta';

                            const scoreEl = document.createElement('span');
                            scoreEl.className = 'comment-score';
                            scoreEl.textContent = formatNumber(commentData.score) + ' points';

                            const timeEl = document.createElement('span');
                            timeEl.className = 'comment-time';
                            timeEl.textContent = formatTimestamp(commentData.created_utc);

                            metaEl.appendChild(scoreEl);
                            metaEl.appendChild(timeEl);

                            // Add all elements to comment
                            commentEl.appendChild(authorEl);
                            commentEl.appendChild(textEl);
                            commentEl.appendChild(metaEl);

                            // Add comment to container
                            commentsContainer.appendChild(commentEl);
                        });

                        // Add "See more comments" link if there are more than 5 comments
                        if (commentsData.length > 5) {
                            const seeMoreEl = document.createElement('div');
                            seeMoreEl.className = 'see-more-comments';
                            seeMoreEl.textContent = `See all ${commentsData.length} comments`;

                            seeMoreEl.addEventListener('click', () => {
                                window.open(`https://www.reddit.com${permalink}`, '_blank');
                            });

                            commentsContainer.appendChild(seeMoreEl);
                        }
                    })
                    .catch(error => {
                        console.error('Error fetching comments:', error);
                        commentsContainer.innerHTML = '<div class="loading-comments">Failed to load comments</div>';
                    });
            }

        function displayResults(data) {
                resultsContainer.innerHTML = '';

                if (!data.children || data.children.length === 0) {
                    resultsContainer.innerHTML = `
                    <div style="padding: 20px; background-color: var(--card-color); border-radius: 4px; text-align: center;">
                        <p>No results found for "${currentQuery}"</p>
                        <p>Try different search terms or filters.</p>
                    </div>
                `;
                    paginationContainer.innerHTML = '';
                    return;
                }

                // Update pagination state
                currentAfter = data.after || null;
                currentBefore = data.before || null;

                // Display results
                data.children.forEach(item => {
                    const post = item.data;

                    // Display domain in url
                    console.log({
                        title: post.title,
                        is_video: post.is_video,
                        domain: post.domain,
                        url: post.url
                    });


                    // Create result card
                    const resultCard = document.createElement('div');
                    resultCard.className = 'result-card';

                    // Create comments section
                    const commentsSection = document.createElement('div');
                    commentsSection.className = 'comments-section';
                    commentsSection.innerHTML = '<div class="loading-comments">Loading comments...</div>';
                    // Don't append comments section yet - we'll do it at the end

                    // Fetch comments for this post
                    fetchComments(post.permalink, commentsSection);

                    // Vote section
                    const voteSection = document.createElement('div');
                    voteSection.className = 'vote-section';

                    const upvoteBtn = document.createElement('button');
                    upvoteBtn.className = 'vote-button';
                    upvoteBtn.innerHTML = `
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="18 15 12 9 6 15"></polyline>
                    </svg>
                `;

                    const voteCount = document.createElement('div');
                    voteCount.className = 'vote-count';
                    voteCount.textContent = formatNumber(post.score);

                    const downvoteBtn = document.createElement('button');
                    downvoteBtn.className = 'vote-button';
                    downvoteBtn.innerHTML = `
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                `;

                    voteSection.appendChild(upvoteBtn);
                    voteSection.appendChild(voteCount);
                    voteSection.appendChild(downvoteBtn);

                    // Content section
                    const contentSection = document.createElement('div');
                    contentSection.className = 'content-section';

                    // Result header with subreddit, author, time
                    const resultHeader = document.createElement('div');
                    resultHeader.className = 'result-header';

                    const subredditLink = document.createElement('a');
                    subredditLink.className = 'result-subreddit';
                    subredditLink.href = `https://www.reddit.com/r/${post.subreddit}`;
                    subredditLink.target = '_blank';

                    // Subreddit icon
                    const subredditIcon = document.createElement('div');
                    subredditIcon.className = 'subreddit-icon';
                    subredditIcon.textContent = post.subreddit.charAt(0).toUpperCase();

                    subredditLink.appendChild(subredditIcon);
                    subredditLink.appendChild(document.createTextNode('r/' + post.subreddit));

                    const authorSpan = document.createElement('span');
                    authorSpan.className = 'result-author';
                    authorSpan.textContent = 'Posted by u/' + post.author;

                    const timeSpan = document.createElement('span');
                    timeSpan.className = 'result-time';
                    timeSpan.textContent = formatTimestamp(post.created_utc);

                    resultHeader.appendChild(subredditLink);
                    resultHeader.appendChild(authorSpan);
                    resultHeader.appendChild(timeSpan);

                    // Result title
                    const resultTitle = document.createElement('div');
                    resultTitle.className = 'result-title';

                    const titleLink = document.createElement('a');
                    titleLink.href = `https://www.reddit.com${post.permalink}`;
                    titleLink.target = '_blank';
                    titleLink.textContent = post.title || 'Comment in thread';

                    resultTitle.appendChild(titleLink);

                    // Result content (text or snippet)
                    const resultContent = document.createElement('div');
                    resultContent.className = 'result-content';

                    let snippet = '';
                    if (post.selftext) {
                        snippet = post.selftext.length > 300
                            ? post.selftext.substring(0, 300) + '...'
                            : post.selftext;
                    } else if (post.body) {
                        snippet = post.body.length > 300
                            ? post.body.substring(0, 300) + '...'
                            : post.body;
                    }

                    resultContent.textContent = snippet;

                    // Result actions (comments, save, share)
                    const resultActions = document.createElement('div');
                    resultActions.className = 'result-actions';

                    const commentsAction = document.createElement('div');
                    commentsAction.className = 'result-action';
                    commentsAction.innerHTML = `
                <svg class="action-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                    </svg>
                    ${post.num_comments || 0} Comments
                `;

                    commentsAction.style.cursor = 'pointer';

                    commentsAction.addEventListener('click', () => {
                        const url = 'https://www.reddit.com' + post.permalink;
                        window.open(url, '_blank');
                    });

                    const saveAction = document.createElement('div');
                    saveAction.className = 'result-action';
                    saveAction.innerHTML = `
                    <svg class="action-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path>
                    </svg>
                    Save
                `;

                    const shareAction = document.createElement('div');
                    shareAction.className = 'result-action';
                    shareAction.innerHTML = `
                    <svg class="action-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="18" cy="5" r="3"></circle>
                        <circle cx="6" cy="12" r="3"></circle>
                        <circle cx="18" cy="19" r="3"></circle>
                        <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
                        <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
                    </svg>
                    Share
                `;

                    resultActions.appendChild(commentsAction);
                    resultActions.appendChild(saveAction);
                    resultActions.appendChild(shareAction);

                    // Add all sections to content area
                    contentSection.appendChild(resultHeader);
                    contentSection.appendChild(resultTitle);

                    if (snippet) {
                        contentSection.appendChild(resultContent);
                    }

                    contentSection.appendChild(resultActions);

                    // Add main sections to card
                    resultCard.appendChild(voteSection);
                    resultCard.appendChild(contentSection);

                    // Add thumbnail/preview image if available
                    // Create container for image (always needed, even if empty)
                    const imgContainer = document.createElement('div');
                    imgContainer.className = 'img-container';
                    imgContainer.style.width = '140px';
                    imgContainer.style.height = '100px';

                    // Add thumbnail/preview image if available
                    
                    const previewImage = post.preview?.images?.[0]?.source?.url?.replace(/&amp;/g, '&');

                    if (previewImage)

                    {
                        const imageLink = document.createElement('a');
                        imageLink.href = `https://www.reddit.com${post.permalink}`;
                        imageLink.target = '_blank';

                        const resultImage = document.createElement('img');
                        resultImage.src = `https://redditfinderproxy.onrender.com/image?url=${encodeURIComponent(previewImage)}`;
                        resultImage.alt = 'Post thumbnail';
                        resultImage.style.maxWidth = '140px';
                        resultImage.style.maxHeight = '100px';
                        resultImage.style.display = 'block';

                        imageLink.appendChild(resultImage);
                        imgContainer.appendChild(imageLink);
                    } else {
                        // No image: make container invisible, but preserve layout
                        imgContainer.style.visibility = 'hidden';
                    }

                    // Test play icon
                    // const playIcon = document.createElement('div');
                    // playIcon.className = 'play-icon';
                    // playIcon.innerHTML = '▶';
                    // imgContainer.appendChild(playIcon);

                    // Add play icon directly to the container if it's a video
                    if (
                        post.is_video ||
                        (post.domain && post.domain.includes('youtu')) ||
                        (post.url && post.url.includes('v.redd.it')) ||
                        (post.domain && post.domain.includes('streamable')) ||
                        (post.url && post.url.endsWith('.gifv'))
                    ) {
                        const playIcon = document.createElement('div');
                        playIcon.className = 'play-icon';
                        playIcon.innerHTML = '▶';

                        playIcon.style.position = 'absolute';
                        playIcon.style.top = '50%';
                        playIcon.style.left = '50%';
                        playIcon.style.transform = 'translate(-50%, -50%)';
                        playIcon.style.zIndex = '20';

                        imgContainer.appendChild(playIcon);
                    }

                    // Add comments section 
                    resultCard.appendChild(commentsSection);

                    // Add container to result card
                    resultCard.appendChild(imgContainer);

                    resultsContainer.appendChild(resultCard);

                    // Update pagination
                    updatePagination();
                
            }); // 👈 close this loop
    }     // 👈 then close the function
            
        function updatePagination() {
            paginationContainer.innerHTML = '';

            if (currentBefore || currentAfter) {
                const prevButton = document.createElement('button');
                prevButton.className = 'pagination-button';
                prevButton.textContent = '← Previous';
                prevButton.disabled = !currentBefore;
                prevButton.addEventListener('click', () => {
                    if (currentBefore) {
                        performSearch(null, currentBefore);
                        window.scrollTo(0, 0);
                    }
                });

                const nextButton = document.createElement('button');
                nextButton.className = 'pagination-button';
                nextButton.textContent = 'Next →';
                nextButton.disabled = !currentAfter;
                nextButton.addEventListener('click', () => {
                    if (currentAfter) {
                        performSearch(currentAfter, null);
                        window.scrollTo(0, 0);
                    }
                });

                paginationContainer.appendChild(prevButton);
                paginationContainer.appendChild(nextButton);
            }
        }

        function formatTimestamp(timestamp) {
            const date = new Date(timestamp * 1000);
            const now = new Date();
            const diffSeconds = Math.floor((now - date) / 1000);

            if (diffSeconds < 60) {
                return `${diffSeconds} second${diffSeconds !== 1 ? 's' : ''} ago`;
            }

            const diffMinutes = Math.floor(diffSeconds / 60);
            if (diffMinutes < 60) {
                return `${diffMinutes} minute${diffMinutes !== 1 ? 's' : ''} ago`;
            }

            const diffHours = Math.floor(diffMinutes / 60);
            if (diffHours < 24) {
                return `${diffHours} hour${diffHours !== 1 ? 's' : ''} ago`;
            }

            const diffDays = Math.floor(diffHours / 24);
            if (diffDays < 30) {
                return `${diffDays} day${diffDays !== 1 ? 's' : ''} ago`;
            }

            const diffMonths = Math.floor(diffDays / 30);
            if (diffMonths < 12) {
                return `${diffMonths} month${diffMonths !== 1 ? 's' : ''} ago`;
            }

            const diffYears = Math.floor(diffMonths / 12);
            return `${diffYears} year${diffYears !== 1 ? 's' : ''} ago`;
        }

        function formatNumber(num) {
            if (num >= 1000000) {
                return (num / 1000000).toFixed(1) + 'm';
            }
            if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'k';
            }
            return num.toString();
        }

        // Security function to prevent XSS
        function sanitizeHTML(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        document.addEventListener('DOMContentLoaded', () => {
                const input = document.querySelector('#subreddit-input');
                const dropdown = document.querySelector('.subreddit-suggestions');

                if (input && dropdown) {
                    // CLICKING OUTSIDE → closes dropdown
                    document.addEventListener('mousedown', (e) => {
                        if (!input.contains(e.target) && !dropdown.contains(e.target)) {
                            dropdown.classList.remove('active');
                        }

                        console.log("Dropdown closer script loaded 😈");

                    });

                    // CLICKING ON A SUGGESTION → apply + close dropdown
                    dropdown.addEventListener('click', (e) => {
                        const clickedItem = e.target.closest('.subreddit-suggestion');
                        if (clickedItem) {
                            input.value = clickedItem.dataset.name || clickedItem.innerText;
                            dropdown.classList.remove('active');
                        }
                    });
                }
            });

    </script>

<script>
    const toggleBtn = document.getElementById('themeToggle');
    const icon = document.getElementById('themeIcon');

    // Apply theme on initial load
    if (localStorage.getItem('theme') === 'dark') {
        document.body.classList.add('dark-mode');
        icon.src = 'sun.png';
        icon.alt = 'Switch to light mode';
    }

    toggleBtn.addEventListener('click', () => {
        document.body.classList.toggle('dark-mode');
        const isDark = document.body.classList.contains('dark-mode');
        localStorage.setItem('theme', isDark ? 'dark' : 'light');
        icon.src = isDark ? 'sun.png' : 'moon.png';
        icon.alt = isDark ? 'Switch to light mode' : 'Switch to dark mode';
    });
</script>

</body>

</html>